{% extends "base.html" %}
{% block body %}

<!-- content -->
<main class="my-5">
  <div class="container">
    <div class="row">
      <div class="list-group col-3">
        <div class="overflow-auto bg-light" style="max-width: auto; max-height:80%">
          <a class="list-group-item list-group-item-action active" aria-current="true">
            {{ curr_event["name_text"] }}
          </a>
          {% for event in data["events"] %}
            {% if event["item_id"] != curr_event["item_id"] %}
              <a href="/discussions.html?id={{ event['item_id'] }}" class="list-group-item list-group-item-action">
                {{ event["name_text"] }}
              </a>
            {% endif %}
          {% endfor %}
        </div>
      </div>
      <div class="list-group col">
        <div class="row">
          <div id="chat" class="overflow-auto bg-light" style="max-width: auto; max-height:800px; height: 800px;">
            <a href="#" class="list-group-item list-group-item-action">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">List group item heading</h5>
                <small>3 days ago</small>
              </div>
              <p class="mb-1">
                Donec id elit non mi porta gravida at eget metus. Maecenas sed diam eget risus
                varius blandit.
              </p>
              <small>Donec id elit non mi porta.</small>
            </a>
            <a href="#" class="list-group-item list-group-item-action">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">List group item heading</h5>
                <small class="text-muted">3 days ago</small>
              </div>
              <p class="mb-1">
                Donec id elit non mi porta gravida at eget metus. Maecenas sed diam eget risus
                varius blandit.
              </p>
              <small class="text-muted">Donec id elit non mi porta.</small>
            </a>
            <a href="#" class="list-group-item list-group-item-action">
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">List group item heading</h5>
                <small class="text-muted">3 days ago</small>
              </div>
              <p class="mb-1">
                Donec id elit non mi porta gravida at eget metus. Maecenas sed diam eget risus
                varius blandit.
              </p>
              <small class="text-muted">Donec id elit non mi porta.</small>
            </a>
          </div>
        </div>
        <div class="row">
          <div class="input-group mt-2">
            <input type="text" class="form-control" placeholder="Type Here" aria-label="event_message"
              aria-describedby="send_message" id="chat_message"/>
              <a class="btn btn-primary" style="background-color: #3b5998;" onclick="send_message()" role="button"
              ><i class="fas fa-angle-right"></i></a>
          </div>
        </div>
      </div>
    </div> 
  </div>
</main> 
<!-- end content -->

{% endblock body %}

{% block script %}

{% if not_found %}

  alert("Event Not Found!!");
  window.location.href = "/home.html"

{% endif %}

  $(function() {
    cookie_json = check_cookie()
    socket = new ReconnectingWebSocket("wss://1fgoc12ik5.execute-api.us-east-1.amazonaws.com/production");
    const queryString = (new URL(document.location)).searchParams;
    console.log(queryString);
    const urlParams = new URLSearchParams(queryString);
    console.log(urlParams);
    event_id = urlParams.get("id")
    console.log(event_id)
    var user_id = cookie_json["user_data"]["email"];
    if(!urlParams.has("id")) {
      alert("No Event ID / Invalid Event ID");
      window.location.href = "/home.html"
    } else {
      socket.onopen = function(event) {
        data = {
          "action": "ping",
          "event_id": event_id
        };
        socket.send(JSON.stringify(data));
      };
    }

    function send_message() {
        data = {
          "action": "message", 
          "event_id": event_id, 
          "user_id": user_id, 
          "message": document.getElementById("chat_message").value
        };
        socket.send(JSON.stringify(data));
    }

  });

{% endblock script %}